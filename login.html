<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/estilo.css">
    <link rel="icon" href="img/logocirculo.png">
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
    <script src="js/firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="sweetalert2.all.min.js"></script>
    <title>Login</title>
</head>

<body class="body">
    <div class="containerDados">
        <a href="index.html"><img src="img/bolo.png" height="100px" width="100px"></a>
        <h1 style="margin: 20px 0px 0px 0px;">Login</h1>
        <form name="login" method="post" class="formCad">
            <label class="required" for="email">E-mail:</label>
            <input type="email" id="email" placeholder="seuemail@mail.com" class="form" required>
            <label class="required" for="senha">Senha:</label>
            <input type="password" id="senha" class="form" required>
        </form>
        <button id="login" class="buttonInput" onclick="verificaAtividade()">Entrar</button>
    </div>
</body>
<script>
    function verificaAtividade() {
        var db = firebase.firestore();
        var email = document.getElementById("email").value;
        db.collection("usuarios").where("email", "==", email).get().then((querySnapshot) => {
            if (querySnapshot.empty) {
                db.collection("funcionarios").where("email", "==", email).get().then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        Swal.fire({
                            title: 'Realize um cadastro',
                            icon: 'alert',
                            confirmButtonColor: '#2ecc71',
                            focusConfirm: false,
                            confirmButtonText: 'Confirmar'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.href = "cadastro.html";
                            }
                        });
                    }
                    else {
                        Swal.fire(
                            'Atenção',
                            'Credenciais inválidas para esse acesso',
                            'error'
                        )
                    }
                });
            } else {
                userLog();
            }
        });
    }
    function userLog() {
        var auth = null;
        var email = document.getElementById("email").value;
        var senha = document.getElementById("senha").value;
        if ((email != '') && (senha != '')) {
            firebase.auth().signInWithEmailAndPassword(email, senha)
                .then(function (user) {
                    auth = user;
                    window.location.href = "index.html";
                })
                .catch(function (error) {
                    Swal.fire(
                        'Atenção',
                        'Senha inválida',
                        'alert'
                    )
                });
        } else {
            Swal.fire(
                'Atenção',
                'Campos obrigatórios não preenchidos',
                'alert'
            )
        }
    };
</script>

</html>